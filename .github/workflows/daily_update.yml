name: Daily RAG Update

# トリガー: 毎日 日本時間 朝9時 (UTC 0:00) 
# または、GitHub上で「Run workflow」ボタンを押した時
on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  update-index:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check out repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip' # pipインストールのキャッシュ

    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    - name: Run Update Script
      env:
        PINECONE_API_KEY: ${{ secrets.PINECONE_API_KEY }}
        PINECONE_INDEX_NAME: ${{ secrets.PINECONE_INDEX_NAME }}
        GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        # HuggingFaceのモデルダウンロード警告抑制など
        HF_HUB_DISABLE_SYMLINKS_WARNING: 1
      run: |
        python update_pinecone.py